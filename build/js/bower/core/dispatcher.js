define(["module","underscore","history","lib/app","lib/router","entity/route"],function(r,t,e,n,i,o){"use strict";function u(r,t){var e,o=i.routeToUrl(r);return o===f?t&&t(null):(f=o,n.log("run",[JSON.stringify(r)]),e=[g.basePath,r.controller()].join("/"),require.defined(e)?(n.trigger("lib/dispatcher:run",[r]),t&&t(null)):require([e],function(){return n.trigger("lib/dispatcher:run",[r]),t&&t(null)},function(i){return n.log("404",[e,i.message]),n.trigger("lib/dispatcher:404",[r]),t&&t(null)}))}function l(r,t){var n=i.urlToRoute(r),o=["/",i.routeToUrl(n)].join("");return e.pushState(n.get(),"",o),u(n,t)}function a(r,e){return t.isString(e)&&l(e)}function c(r){r.preventDefault();var t=n.getElement(r,".lib_dispatcher-link");return l(t.attr("href"))}function d(r){return l(document.location.href,r)}function s(r){return l(document.location.href,r)}n.log("Loaded");var f,g=t.defaults(r.config(),{basePath:"app/controllers"});return e.Adapter.bind(window,"statechange",function(){var r=e.getState(),t=new o(r.data);return u(t)}),n.on("lib/dispatcher:dispatch",null,a).on("lib/dispatcher:reload",null,s).on("click",".lib_dispatcher-link",c),{dispatch:l,restoreState:d,reload:s}});
//# sourceMappingURL=dispatcher.js.map