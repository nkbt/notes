define(["dom","underscore","lib/app","lib/map"],function(e,a,n,r){"use strict";function o(e,n){var o=new r.googleMaps.LatLngBounds;a.forEach(n,function(e){o.extend(e.marker.position)}),e.fitBounds(o)}function t(e,a,t,m,g){var p=new r.googleMaps.LatLng(t,m);return r(e,function(t,m){var i=e.data("map-googleMarkers")||{};return i[a]={marker:new r.googleMaps.Marker({map:m,position:p,draggable:!1}),info:new r.googleMaps.InfoWindow({content:g})},o(m,i),r.googleMaps.event.addListener(i[a].marker,"click",function(){i[a].info.open(m,i[a].marker),n.trigger(e,"map:marker:click",[a])}),r.googleMaps.event.addListener(m,"click",function(){n.trigger(e,"map:click")}),e.data("map-googleMarkers",i),n.trigger(e,"map:markerAdd:done")})}function m(e,a,o,t,m){var g=new r.googleMaps.LatLng(o,t),p=e.data("map-googleMarkers")||{};return p[a]?(p[a].marker.setPosition(g),p[a].info.setContent(m),e.data("map-googleMarkers",p),n.trigger(e,"map:markerUpdate:done")):n.trigger(e,"map:markerUpdate:done")}function g(e,a){var o=e.data("map-googleMarkers")||{};return o[a]&&(r.googleMaps.event.clearInstanceListeners(o[a].marker),r.googleMaps.event.clearInstanceListeners(o[a].info),o[a].marker.setMap(null),o[a].info.setMap(null),o[a]=null,delete o[a],e.data("map-googleMarkers",o)),n.trigger(e,"map:markerRemove:done")}function p(e,a,r,o,m){var g=n.getElement(e,".map");return t(g.find(".map-map"),a,r,o,m)}function i(e,a,r,o,t){var g=n.getElement(e,".map");return m(g.find(".map-map"),a,r,o,t)}function d(e,a){var r=n.getElement(e,".map");return g(r.find(".map-map"),a)}function l(e){var a,o=n.getRoot(e,".map");return o?(a=o.find(".map-map"),r(a)):e}return n.log("Loaded"),n.on("lib/layout:changed",".map",l).on("map:markerAdd",".map",p).on("map:markerUpdate",".map",i).on("map:markerRemove",".map",d)});
//# sourceMappingURL=map.js.map